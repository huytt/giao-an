@{
    ViewBag.Action = "Sale-Edit";
    ViewBag.Controller = "TTS";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    var ListAccount = (List<HTTelecom.Domain.Core.DataContext.ams.Account>)ViewBag.listAccount;
}

@model HTTelecom.Domain.Core.DataContext.tts.MainRecord
<div class="page-header page-header-block">
    <div class="page-header-section">
        <h4 class="title semibold">Sale Exception -  [ JQCOF-2-D500 ]</h4>
    </div>
</div>
@if (TempData["Errors"] != null)
{
    <div class="alert alert-danger">
        <span class="semibold">@TempData["Errors"].ToString()</span>
    </div>
}
@using (Html.BeginForm("SaleExptionEdit", "TTS", FormMethod.Post, new { enctype = "multipart/form-data", id = "FormProCreate" }))
{
    @Html.Hidden("MainRecordId", (long)ViewBag.MainRecordId)
    @Html.Hidden("StatusDirectionCode", (string)Model.StatusDirectionCode)
    <div class="row" id="divContentSub">
        <div class="col-sm-12">
            <div class="row">
                <div class="col-sm-12" style="  display: table;width: 100%;">
                    <div style=" display: table-cell; text-align: center; vertical-align: middle;">
                        <img src="http://galagala.vn:88/Images/galagala_wed_2.png" width="200" style="height: auto; padding:10px;" />
                    </div>
                    <div style=" display: table-cell; vertical-align: middle;">
                        <h4 style="margin:0px;">WEBSITE THƯƠNG MẠI ĐIỆN TỬ - MUA HÀNG TRỰC TUYẾN</h4>
                        <p>Hỗ trợ khách hàng 7 ngày / tuần: 1900000</p>
                        <p>Email: hopthanhbusiness@gmail.com</p>
                    </div>
                </div>
            </div>
            <div class="row">
                <h1 class="text-center">ORDER FORM</h1>
            </div>
            <hr class="margin" />
            <div class="margin"></div>
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-blue">
                        <div class="panel-collapse pull out">
                            <table class="table table-bordered">
                                <tbody>
                                    <tr>
                                        <td width="10%"><h5><strong>Task Form</strong></h5></td>
                                        <td width="38%">
                                            <h4>@ViewBag.TaskFormString</h4>
                                        </td>
                                        <td width="10%"><h5><strong>Form Id</strong></h5></td>
                                        <td width="40%">
                                            <a href="#"><h5>@Model.FormId</h5></a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td width="10%"><h5><strong>Status Direction</strong></h5></td>
                                        <td width="38%">
                                            <h4>@ViewBag.StatusDirectionName</h4>
                                        </td>
                                        <td width="10%"><h5><strong>Status Process</strong></h5></td>
                                        <td width="40%">
                                            <h4>@ViewBag.StatusProcessName</h4>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td width="5%"><h5><strong>Description</strong></h5></td>
                                        <td width="80%" colspan="3">
                                            <h4>@Model.Description</h4>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            @{Html.RenderAction("OrderViewForm", "TTS", new { code = Model.FormId });}

            <div class="row">
                <div class="col-sm-12">
                    <div class="panel panel-blue">
                        <div class="panel-collapse pull out">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th style="background-color: #D9EDF7">Date</th>
                                        <th style="background-color: #D9EDF7">Comment</th>
                                        <th style="background-color: #D9EDF7">Signature</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
            var Sub = ((List<HTTelecom.WebUI.Sale.Common.SubRecordJson>)ViewBag.SubList).ToList().LastOrDefault();
            //var itemstatusDirectionInSub = ((List<HTTelecom.Domain.Core.DataContext.tts.StatusDirection>)ViewBag.list_StatusDirection).Where(n => n.StatusDirectionId == Int64.Parse(item.StatusDirectionId)).FirstOrDefault();
            var itemAccountInSub = ListAccount.Where(n => n.AccountId == Int64.Parse(Sub.HolderId)).FirstOrDefault();
            <tr>
                <td width="10%" style="vertical-align:top">
                    <h4>@Sub.DateReceived</h4>
                    @(itemAccountInSub.Department != null ? itemAccountInSub.Department.DepartmentName : "")
                </td>
                <td width="40%" style="vertical-align:top">
                    <h4>@Html.Raw(Sub.Description)</h4>

                </td>
                <td width="20%">
                    <p class="text-uppercase text-center" style="padding-top: 85px; margin-bottom: 0px; ">@itemAccountInSub.FullName</p>
                </td>
            </tr>
                                    }
                                    <tr>
                                        <td width="10%" style="vertical-align:top">
                                            <h4>
                                                @DateTime.Now.ToShortDateString()
                                            </h4>

                                        </td>
                                        <td width="40%" style="vertical-align:top">
                                            @Html.TextArea("DescriptionSub", new
                                       {
                                           rows = "5",
                                           @class = "form-control",
                                           placeholder = "Write comment...",
                                           style = "border-top-width: 0px; border-right-width: 0px; border-left-width: 0px; border-bottom-width: 0px; resize:none"
                                       })
                                        </td>
                                        <td width="20%">
                                            <p class="text-uppercase text-center" style="padding-top: 85px; margin-bottom: 0px; ">
                                                @(((HTTelecom.Domain.Core.DataContext.ams.Account)Session["Account"]).FullName)
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="text-center row">
        <a class="btn btn-success btn-submit-form" data-code="SDC1">Continue</a>
        <a class="btn btn-danger btn-submit-form" data-code="SDC3">Cancel</a>
    </div>
    <br />
    <div class="row text-right">
        <a class="btn btn-danger printElement-User" data-user-content="divContentSub">Print form</a>
    </div>
}
<script>
    $(document).ready(function () {
        $(".btn-submit-form").click(function () {
            var t = $(this);
            $("input[type='hidden'][name='StatusDirectionCode']").val(t.attr('data-code'))
            $("#FormProCreate").submit()
        })
    })
</script>