@{
    ViewBag.LayoutTitle = "BuyNow";
    var Product = (HTTelecom.Domain.Core.DataContext.mss.Product)ViewBag.Product;
    var ProductInMedia = (HTTelecom.Domain.Core.DataContext.mss.ProductInMedia)ViewBag.ProductInMedia;
    var ListSize = (List<HTTelecom.Domain.Core.DataContext.mss.Size>)ViewBag.ListSize;
    var price = Product.PromotePrice != null && Product.PromotePrice < Product.MobileOnlinePrice ? Product.PromotePrice : Product.MobileOnlinePrice;
    ViewBag.Back = Url.Action("Index", "Home");
    ViewBag.LayoutKeywords = "mua hàng trực tuyến, mua hàng online, mua hàng giá rẻ, bán hàng trực tuyến, mua hàng online, galagala việt nam, mua hàng qua mạng, mua bán trực tuyến, mua đồ trên mạng, mua hàng giá rẻ";
    ViewBag.LayoutDescription = "Mua hàng trực tuyến từ galagala.vn với mức giá, khuyến mãi hấp dẫn và nhiều mặt hàng đa dạng từ laptop, máy tính bảng, điện thoại v.v...";
    ViewBag.Layout_ogTitle = "Mua hàng Trực tuyến Giá rẻ - Mua hàng trên Galagala Việt Nam";
    ViewBag.Layout_image = "~/Content/icon.png";
    ViewBag.Layout_description = "Mua hàng trực tuyến từ galagala.vn với mức giá, khuyến mãi hấp dẫn và nhiều mặt hàng đa dạng từ laptop, máy tính bảng, điện thoại v.v...";
    var lstSizeProduct = Product.Size.Split(',');
    var sizeOne = lstSizeProduct.Count() == 1 && lstSizeProduct[0] != "" ? ListSize.Where(n => n.SizeId == Convert.ToInt64(lstSizeProduct[0])).FirstOrDefault() : null;
}
<div class="user-breadcrumb user-flat">
    <a class="active" style="width: 33%;">@((string)ViewBag.multiRes.GetString("create_order", ViewBag.CultureInfo))</a>
    <a style="width: 33%;">@((string)ViewBag.multiRes.GetString("information_order", ViewBag.CultureInfo))</a>
    <a style="width: 34%;">@((string)ViewBag.multiRes.GetString("checkout", ViewBag.CultureInfo))</a>
</div>
@if (TempData["gMessageCurrent"] != null)
{
    var gMessageCurrent = (List<string>)TempData["gMessageCurrent"];
    <div class="row user-margin-0">
        <div class="col s12" style="text-align:center;color:red;">
            @foreach (var item in gMessageCurrent)
            {
                <p>@item</p>
            }
        </div>
    </div>
}
@using (Html.BeginForm("BuyNow", "Product", FormMethod.Post, new { id = "Cartform" }))
{
    var hrefProduct = Product.ProductTypeCode == "PT1" ? "OrdProduct" : Product.ProductTypeCode == "PT2" ? "SaleProduct" : Product.ProductTypeCode == "PT3" ? "ChargeProduct" : "FreeProduct";
    @Html.Hidden("ProductId", (long)ViewBag.ProductId)
    @Html.Hidden("SizeId", (long)ViewBag.Size)
    <div class="row">
        <div class="col s12 m12 wishListItem">
            <div class="card-panel grey lighten-5 z-depth-1" style="padding: 5px; position: relative; margin: .5rem 0 .5rem; ">
                <p style=" margin: 0; line-height: 2; padding: 1px; margin-right: 28px;">
                    <a href="@Url.Action(hrefProduct, "Product", new { id = Product.ProductId, urlName = Product.Alias, urlNameStore = Product.Store.Alias })">@Product.ProductName</a>
                </p>
                <div class="clearfix"></div>
                <div style="line-height:0;">
                    <div class="" style=" display: table-cell; vertical-align: top; padding: 8px;">
                        <img class="lazyload" data-sizes="auto"
                              src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" 
                             data-src="@(HTTelecom.WebUI.eCommerce.Common.HTXoneServer.Connect + ProductInMedia.Media.Url + ProductInMedia.Media.MediaName)" alt="@Product.ProductName" height="48">
                    </div>
                    <div class="media-body" style=" display: table-cell; vertical-align: top; width: 100%;">
                        <p style="text-align: left; line-height: 20px; margin: 0px;">
                            @((string)ViewBag.multiRes.GetString("price", ViewBag.CultureInfo)):
                            <span class="user-priceProduct user-color-red" data-money="@price">
                                @string.Format("{0:0,0 đ}", price)
                            </span>
                        </p>
                        <p style="text-align: left; line-height: 20px; margin: 0px;">
                            @((string)ViewBag.multiRes.GetString("quantity", ViewBag.CultureInfo)):
                            <input type="number" name="numBuyNow" value="@ViewBag.quantity" class="number-price-change" style=" width: 50px; height: 23px; margin: 0px; border: 2px solid #c3c3c3; border-radius: 5px; text-align: center;" max="50" min="1" maxlength="2" />
                        </p>
                        @if (ViewBag.Size != 52)
                        {
                            <p style="text-align: left; line-height: 20px; margin: 0px;">
                                @((string)ViewBag.multiRes.GetString("size", ViewBag.CultureInfo)):
                                <span class="spanSize">
                                    @if (ViewBag.Size != 0)
                                    {
                                        var size = ListSize.Where(n => n.SizeId == Convert.ToInt64(ViewBag.Size)).FirstOrDefault();
                                        @size.SizeName
                                    }
                                    else
                                    {
                                        <a style='color:blue' class='btnSelectSize cursor-point' data-value='@Product.Size'>
                                            Select Size
                                        </a>
                                    }
                                </span>
                                @if (ViewBag.Posted != null)
                                {
                                    <span class='errorUser user-margin-0' style='color:red;float:right;'><img src='../../Images/alert.png' style='  width: 18px;' /></span>
                                }
                            </p>
                        }

                        @if (Product.Colour != null)
                        {
                            <p style="text-align: left; line-height: 20px; margin: 0px;">
                                @((string)ViewBag.multiRes.GetString("colour", ViewBag.CultureInfo))@(":") @Product.Colour
                            </p>
                        }
                        <p style="text-align: left; line-height: 20px; margin: 0px;" class="totalPricechilldren">
                            @((string)ViewBag.multiRes.GetString("total", ViewBag.CultureInfo)):
                            <span class="user-totalpriceProduct" data-money="@price" data-totalmoney="@price" style="text-align: right;">@string.Format("{0:0,0 đ}", price)</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col m12" style="width:100%;">
            <a class="btn right waves-orange user-margin-top-10" data-element="background" id="btnSubmit">@((string)ViewBag.multiRes.GetString("_continue", ViewBag.CultureInfo))</a>
        </div>
    </div>
}
<div id="modal_Select" class="modal">
    <div class="modal-content user-padding-10">
    </div>
</div>

@section JavaScript {
    <script>
        var gListSize = [];
        @foreach (var item in ListSize)
	{
		 <text>
        gListSize.push({ SizeId: '@item.SizeId', SizeName: '@item.SizeName', SizeGlobalId: '@item.SizeGlobalId' })
        </text>
	}
        $(document).ready(function () {
            $("#btnSubmit").click(function () {
                var lst = $(".btnSelectSize");
                $(".errorUser").remove();
                if (lst.length > 0)
                    $.map(lst, function (ele, ind) {
                        if ($(ele).parent().append("<span class='errorUser user-margin-0' style='color:red;float:right;'><img src='../../Images/alert.png' style='  width: 18px;'/></span>"));
                    })
                else
                    $("#Cartform").submit();
            })
            $(".btnSelectSize").click(function () {
                var lstValue = $(this).attr('data-value').split(',');
                $("#modal_Select").children(".modal-content").children().remove();
                var modal_content = $("#modal_Select").children(".modal-content");
                modal_content.append("<h4 class='user-text-center'>List Size</h4>")
                $.map(lstValue, function (ele, ind) {
                    for (var i = 0; i < gListSize.length; i++) {
                        if (gListSize[i].SizeId == ele) {
                            modal_content.append("<a class='btnModalAddChooseSize cursor-point' data-id='" + ele + "' ><div class='itemModalSize'>" + gListSize[i].SizeName + "</div></a>");
                        }
                    }

                })
                modal_content.append("<div class='clearfix'></div>")
                //var select = "<select >"
                //$('.modal-trigger').leanModal();
                $("#modal_Select").openModal();
            })

        })
        $(document).on('click', '.btnModalAddChooseSize', function (e) {
            var tar = $(e.target).hasClass("itemModalSize") ? $(e.target).parent() : $(e.target);
            tar.attr('data-id'), tar.attr("data-ind");
            //$(".formCart").find('input[type="hidden"][name="[' + tar.attr('data-ind') + '].Size"]').val(tar.attr('data-id'));
            $("input[type='hidden'][name='SizeId']").val(tar.attr('data-id'))
            $(".spanSize").text(tar.children().text());
            $("#modal_Select").closeModal();
        })
    </script>

}

@section CSS{
    <style>
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button {
            opacity: 1;
        }

        .itemModalSize {
            width: 60px;
            height: 30px;
            background: #0A8255;
            padding: 5px;
            display: table-cell;
            color: white;
            vertical-align: middle;
            line-height: 21px;
            float: left;
            border-radius: 5px;
            text-align: center;
            margin-right: 5px;
        }
    </style>
}